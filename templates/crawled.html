<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/static/css/global.css">
    <link rel="stylesheet" type="text/css" href="/static/css/crawled.css">
    <script src="/static/js/cytoscape.min.js"></script>
    <title>Results</title>
</head>
<body>
    <div id="cy">
        
    </div>
    
     <script>
        // for graph in graphs
        // 



        let origin = '{{ graphs[0].provenance }}'
        let signposts = []
        {% for s, p, o in graphs[0].signposts %}
            predicate = '{{p}}'
            predicate = predicate.split('/').pop();
            signposts.push(
                {group: 'nodes', data: {id: '{{o}}'} },
                {group: 'edges', data: {source: '{{s}}', target: '{{o}}', label: predicate } }//id: count, 
            )
        {% endfor %}
        {% for link in graphs[0].linksets %}
            linkset = '{{link}}'
            console.log(linkset)
            {% for s, p, o in graphs[0].linksets[link].signposts %}
                predicate = '{{p}}'
                predicate = predicate.split('/').pop();
                signposts.push(
                    {group: 'nodes', data: {id: '{{o}}'} },
                    {group: 'edges', data: {source: linkset, target: '{{o}}', label: predicate } }//id: count, 
                )
            {% endfor %}
        {% endfor %}


        console.log(signposts)
        
        var cy = cytoscape({
            container: document.getElementById('cy'),

            elements: {
                nodes: [
                {
                    data: { id: origin }
                }
                ]
            },

           // layout: {
           //     name: 'grid',
           //     rows: 1
           // },

            // so we can see the ids
            style: [
                {
                selector: 'node',
                style: {
                    'label': 'data(id)', // Use node's 'label' property
                    //'text-valign': 'center', // Center vertically
                    //'text-halign': 'center', // Center horizontall
                    'background-color': 'white'
                }
                },
                {
                selector: 'edge',
                style: {
                    'label': 'data(label)',
                    //'text-margin-y': -20,
                    'target-arrow-shape': 'triangle', // Arrow at target node
                    'target-arrow-color': 'black',    // Match edge color
                    'curve-style': 'bezier'
                }
                }
            ]
        });
        cy.add(signposts)

        var layout = cy.elements().layout({
            name: 'circle'
          });
          
        layout.run();

        cy.edges().forEach(edge => {
            colour = colourCode(edge.data('label'))
            edge.style('line-color', colour);
        });

        function colourCode(predicate) 
        {
            switch (predicate)
            {
                case "citeas":
                    return "blue";
                    break;
                case "item":
                    return "red";
                    break;
                case "describedby":
                    return "green";
                    break;
                case "license":
                    return "orange";
                    break;
                case "type":
                    return "yellow";
                    break;
                case "linkset":
                    return "purple";
                    break;
                case "author":
                    return "brown";
                    break;
                case "collection":
                    return "pink";
                    break;
                default:
                    return "black"
            }
        }
     </script>
</body>
</html>